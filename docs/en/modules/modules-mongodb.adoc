= Mongo DB

To use the Mongo DB module, you just need to include a reference in pom.xml

[source,xml]
.pom.xml
----
<dependency>
    <groupId>hu.icellmobilsoft.roaster</groupId>
    <artifactId>roaster-mongodb</artifactId>
</dependency>
----

== Configuration parameters

Microprofile-config can be used to parameterize the data needed to access mongodb.

Example:

[source,yml]
.META-INF/roaster-defaults.yml
----
coffee:
    mongodb:
        default: #<1>
            database: foobar
            uri: mongodb://user:pass@localhost:27017/?ssl=false #<2>
----
<1> This is the `configKey` to be used in the `@MongoClientConfiguration` annotation
<2> https://docs.mongodb.com/manual/reference/connection-string/

Specifying `database` and `url` is a binder. There are also additional tuning options,
which can be found in the coffee documentation.

== Usage

[source,java]
----
class MongoExampleIT extends BaseConfigurableWeldIT {

    @Inject
    @MongoClientConfiguration(configKey = "default")
    private Instance<MongoDbClient> mongoDbClientInstance;

    @Test
    void test() throws BaseException {
        MongoDbClient mongoDbClient = mongoDbClientInstance.get();

        // specify collection
        mongoDbClient.initRepositoryCollection("example_collection");

        // insert an element
        Object object = Map.of("foo", "bar");
        BasicDBObject dtoDocument = MongoUtil.jsonToBasicDbObject(MongoJsonUtil.toJson(object));
        mongoDbClient.insertOne(dtoDocument);

        // get the id of the inserted element
        String id = dtoDocument.getString("_id");

        // search with filter
        BasicDBObject filter = new BasicDBObject();
        filter.put("_id", new ObjectId(id));
        BasicDBObject result1 = mongoDbClient.findFirst(filter);
        System.out.println(result1);

        // search by id
        BasicDBObject result2 = mongoDbClient.findById(id);
        System.out.println(result2);
    }
}
----
